{% extends "base.html.twig" %}

{% block title %}
	{{ parent() }}
	Boutique
{% endblock %}

{% block nav_class %}
	transparent navbar-dark navbar-bg-dark
{% endblock %}

{% block body %}
	
	<section class="wrapper bg-light">
		<div class="container pb-14 pb-md-16 pt-12">
			<div class="row gy-10">
				<div class="col-lg-8">
					<div class="row align-items-center mb-10 position-relative zindex-1">
						<div class="col-md-7 col-xl-8 pe-xl-20">
							<h2 class="display-6 mb-1">Derniers produits</h2>
							{# <p class="mb-0 text-muted">1–9 sur 30 résultats</p> #}
						</div>
{#						<div class="col-md-5 col-xl-4 ms-md-auto text-md-end mt-5 mt-md-0">#}
{#							<div class="form-select-wrapper">#}
{#								<label>#}
{#									<select class="form-select">#}
{#										<option value="popularity">Classer par popularité</option>#}
{#										<option value="rating">Classer par note moyenne</option>#}
{#										<option value="newness">Classer par nouveauté</option>#}
{#										<option value="price: low to high">Classer par prix : du moins cher au plus cher</option>#}
{#										<option value="price: high to low">Classer par prix : du plus cher au moins cher</option>#}
{#									</select>#}
{#								</label>#}
{#							</div>#}
{#						</div>#}
					</div>
					<div class="grid grid-view projects-masonry shop mb-13">
						<div class="isotope-filter filter mb-10">
							<p>Filtrer :</p>
							<ul>
								<li><a class="filter-item active" data-filter="*">Tous</a></li>
								<li><a class="filter-item" data-filter=".armes">Armes</a></li>
								<li><a class="filter-item" data-filter=".vêtements">Vêtements</a></li>
							</ul>
						</div>
{#						<div class="isotope-filter filter mb-10">#}
{#							<ul>#}
{#								<li><a class="filter-item active" data-filter="*">Tous les prix</a></li>#}
{#								<li><a class="filter-item" data-filter=".10">0,00 € - 10,00 €</a></li>#}
{#								<li><a class="filter-item" data-filter=".20">10,00 € - 20,00 €</a></li>#}
{#								<li><a class="filter-item" data-filter=".30">20,00 € - 50,00 €</a></li>#}
{#								<li><a class="filter-item" data-filter=".plus">Plus de 50,00 €</a></li>#}
{#							</ul>#}
{#						</div>#}
						<div class="row gx-md-8 gy-10 gy-md-13 isotope">
							{% for product in products %}
								<div class="project item col-md-6 col-xl-4 {{ product.price}} {{ product.category|lower }}">
									<figure class="rounded mb-6">
										<img
												style="height: 314.79px !important; object-fit: cover;"
												src="/uploads/{{ product.image }}"
												srcset="/uploads/{{ product.image }}"
												alt="image du {{ product.name }}"
										/>
										<a class="item-like" href="#" data-bs-toggle="white-tooltip" title="Ajouter à ma liste de vœux">
											<i class="uil uil-heart"></i>
										</a>
										<a class="item-view" href="#" data-bs-toggle="white-tooltip" title="Vue rapide">
											<i class="uil uil-eye"></i>
										</a>
										<a href="{{ path('cart_add', { 'id': product.id }) }}" class="item-cart"><i class="uil uil-shopping-bag">
											</i> Ajouter au panier
										</a>
										<span class="avatar bg-pink text-white w-10 h-10 position-absolute text-uppercase fs-13" style="top: 1rem; left: 1rem;"><span>Vente</span></span>
									</figure>
									<div class="post-header">
										<div class="d-flex flex-row align-items-center justify-content-between mb-2">
											<div class="post-category text-ash mb-0">{{ product.category }}</div>
										</div>
										<h2 class="post-title h3 fs-22">
											<a href="#" class="link-dark">{{ product.name }}</a>
										</h2>
										<p class="price"><span class="amount">{{ product.price }} €</span></p>
									</div>
								</div>
							{% endfor %}
						</div>
					</div>
				</div>
				<div class="col-lg-4 order-lg-2">
					<h3 class="mb-4">Résumé de la commande</h3>
					<div class="shopping-cart mb-7">
						{% for item in items %}
							{% if item.product is defined %}
								<div class="shopping-cart-item d-flex justify-content-between mb-4">
									<div class="d-flex flex-row d-flex align-items-center">
										<figure class="rounded w-17">
											<a href="#">
												<img
														src="/uploads/{{ item.product.image }}"
														srcset="/uploads/{{ item.product.image }}"
														alt="image du {{ item.product.image }}"
												/>
											</a>
										</figure>
										<div class="w-100 ms-4">
											<h3 class="post-title h6 lh-xs mb-1">
												<a href="#" class="link-dark">{{ item.product.name }} ({{ item.quantity }})
												</a>
											</h3>
											<div class="small">{{ item.product.description }}</div>
										</div>
									</div>
									<div class="ms-2 d-flex align-items-center">
										<p class="price fs-sm"><span class="amount">{{ item.product.price * item.quantity }}€</span></p>
									</div>
								</div>
							{% endif %}
						
						{% endfor %}
					</div>
					<div class="table-responsive">
						<table class="table table-order">
							<tbody>
							<tr>
								<td class="ps-0"><strong class="text-dark">Total</strong></td>
								<td class="pe-0 text-end">
									<p class="price text-dark fw-bold">{{ total }}€</p>
								</td>
							</tr>
							</tbody>
						</table>
					</div>
					<a href="#" id="checkout-button" class="btn btn-primary rounded w-100 mt-4">Payer</a>
				</div>
				
				{#				<aside class="col-lg-3 sidebar">#}
{#					<div class="widget">#}
{#						<h4 class="widget-title mb-3">Prix</h4>#}
{#						<div class="form-check mb-1">#}
{#							<input class="form-check-input" type="radio" name="price" id="price1" value="0-10">#}
{#							<label class="form-check-label" for="price1"> 0,00 € - 10,00 € </label>#}
{#						</div>#}
{#						<div class="form-check mb-1">#}
{#							<input class="form-check-input" type="radio" name="price" id="price2" value="10-20">#}
{#							<label class="form-check-label" for="price2"> 10,00 € - 20,00 € </label>#}
{#						</div>#}
{#						<div class="form-check mb-1">#}
{#							<input class="form-check-input" type="radio" name="price" id="price3" value="20-50">#}
{#							<label class="form-check-label" for="price3"> 20,00 € - 50,00 € </label>#}
{#						</div>#}
{#						<div class="form-check mb-1">#}
{#							<input class="form-check-input" type="radio" name="price" id="price4" value="50-100">#}
{#							<label class="form-check-label" for="price4"> 50,00 € - 100,00 € </label>#}
{#						</div>#}
{#					</div>#}
{#				</aside>#}
			</div>
		</div>
	</section>
	<section class="wrapper bg-gray">
		<div class="container py-12 py-md-14">
			<div class="row gx-lg-8 gx-xl-12 gy-8">
				<div class="col-md-6 col-lg-4">
					<div class="d-flex flex-row">
						<div>
							<img src="./assets/img/icons/solid/shipment.svg" class="svg-inject icon-svg icon-svg-sm solid-mono text-navy me-4" alt="" />
						</div>
						<div>
							<h4 class="mb-1">Livraison</h4>
							<p class="mb-0">Le coût de la livraison dépendra du poids total des produits.</p>
						</div>
					</div>
				</div>
				<div class="col-md-6 col-lg-4">
					<div class="d-flex flex-row">
						<div>
							<img src="./assets/img/icons/solid/push-cart.svg" class="svg-inject icon-svg icon-svg-sm solid-mono text-navy me-4" alt="" />
						</div>
						<div>
							<h4 class="mb-1">Garantie qualité</h4>
							<p class="mb-0">Nous vous garantissons la qualité des produits livrés, et un remboursement en cas de produit défectueux.</p>
						</div>
					</div>
				</div>
				<div class="col-md-6 col-lg-4">
					<div class="d-flex flex-row">
						<div>
							<img src="./assets/img/icons/solid/verify.svg" class="svg-inject icon-svg icon-svg-sm solid-mono text-navy me-4" alt="" />
						</div>
						<div>
							<h4 class="mb-1">Garantie qualité</h4>
							<p class="mb-0">Nous vous garantissons la qualité des produits livrés, et un remboursement en cas de produit défectueux.</p>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
	
	<script>
        document.addEventListener("DOMContentLoaded", function () {
            const priceFilters = document.querySelectorAll('input[name="price"]');

            priceFilters.forEach(filter => {
                filter.addEventListener('change', function () {
                    const selectedPriceRange = this.value;

                    // Crée une requête AJAX avec Fetch API
                    fetch(`/filter/products?priceRange=${selectedPriceRange}`, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    })
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }
                            return response.json();
                        })
                        .then(data => {
                            // Vide la liste actuelle des produits
                            const isotopeContainer = document.querySelector('.isotope');
                            const iso = new Isotope(isotopeContainer, {
                                itemSelector: '.item',
                                layoutMode: 'fitRows'
                            });

                            iso.layout();
                            isotopeContainer.innerHTML = '';

                            // Parcourt les produits reçus et les ajoute au DOM
                            data.products.forEach(product => {
                                const productHtml = `
                        <div class="project item col-md-6 col-xl-4 ${product.category.toLowerCase()}">
                            <figure class="rounded mb-6">
                                <img style="height: 314.79px !important; object-fit: cover;" src="/uploads/${product.image}" alt="image du produit" />
                                <a class="item-like" href="#" title="Ajouter à ma liste de vœux">
                                    <i class="uil uil-heart"></i>
                                </a>
                                <a class="item-view" href="#" title="Vue rapide">
                                    <i class="uil uil-eye"></i>
                                </a>
                                <a href="/cart/add/${product.id}" class="item-cart">
                                    <i class="uil uil-shopping-bag"></i> Ajouter au panier
                                </a>
                            </figure>
                            <div class="post-header">
                                <div class="d-flex flex-row align-items-center justify-content-between mb-2">
                                    <div class="post-category text-ash mb-0">${product.category}</div>
                                    <span class="ratings five"></span>
                                </div>
                                <h2 class="post-title h3 fs-22">
                                    <a href="#" class="link-dark">${product.name}</a>
                                </h2>
                                <p class="price"><span class="amount">${product.price} €</span></p>
                            </div>
                        </div>`;
                                isotopeContainer.insertAdjacentHTML('beforeend', productHtml);
                            });
                        })
                        .catch(error => {
                            console.error('Une erreur s\'est produite lors du chargement des produits:', error);
                        });
                });
            });
        });
	</script>

{% endblock body %}
